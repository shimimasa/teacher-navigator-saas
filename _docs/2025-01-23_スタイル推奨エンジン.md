# 2025-01-23 スタイル推奨エンジンの実装

## 実施内容

### 1. StyleRecommenderService（services/styleRecommender.js）

#### 主要機能
- パーソナリティタイプに基づく授業スタイル推奨
- 診断結果を活用した詳細な推奨アルゴリズム
- 推奨スコアの計算とマッチング理由の生成
- 複数スタイルの比較分析機能

#### 実装メソッド
- `recommendByPersonalityType()` - パーソナリティタイプ別推奨
- `recommendByDiagnosisId()` - 診断ID基準の推奨
- `compareStyles()` - 複数スタイルの比較分析
- `calculateRecommendationScore()` - 推奨スコア計算
- `generateMatchingReasons()` - マッチング理由生成
- `enhanceRecommendationsWithDiagnosisData()` - 診断データによる推奨強化

### 2. 推奨アルゴリズムの詳細

#### スコア計算ロジック
1. **基本マッチング（50点）**
   - パーソナリティタイプとの直接的な互換性

2. **特性マッチング（最大30点）**
   - 強みとスタイル特性の一致度（各10点）
   - 教授法の相性（各15点）

3. **教科適合性（20点）**
   - 指定教科とスタイルの適合性

4. **使用統計ボーナス（最大25点）**
   - 平均評価4.5以上: +15点
   - 平均評価4.0以上: +10点
   - 採用率70%以上: +10点

5. **診断スコアボーナス（各5点）**
   - 外向性 > 60% + interactive特性
   - 思考性 > 60% + analytical特性
   - 感覚性 > 60% + practical特性
   - 判断性 > 60% + structured特性

#### マッチング理由の生成
- パーソナリティタイプとの直接的な相性
- 個人の強みとスタイル特性の一致
- 課題改善への貢献可能性
- 高評価による信頼性

### 3. 比較分析機能

#### compareStylesメソッド
- 複数スタイルの同時比較
- 推奨スコアに基づくランキング
- 詳細な比較分析レポート生成

#### 分析内容
- **スコア差10点未満**: すべて適切、使い分け推奨
- **スコア差10-20点**: 最上位を推奨、他も効果的
- **スコア差20点以上**: 最上位が最適

### 4. テスト実装（__tests__/services/styleRecommender.test.js）

#### テストカバレッジ
- パーソナリティタイプ別推奨の正常動作
- 診断ID基準の推奨機能
- フィルタリング機能（教科、学年）
- エラーハンドリング（無効な入力）
- スコア計算の妥当性検証
- マッチング理由の適切性
- 比較分析機能の動作確認

### 5. 使用場面の提案機能

#### スタイル別の推奨使用場面
- **構造化ファシリテーター型**: 新概念の体系的指導
- **創造的探求者型**: 創造性の引き出し
- **体系的指導者型**: 基礎知識の定着
- **共感的メンター型**: 個別学習支援
- **ダイナミック実演型**: 興味関心の喚起
- **分析的コーチ型**: データ基準の指導
- **協働的組織者型**: グループ学習促進
- **実践的実証型**: 実践スキル指導

## 技術的決定事項

### アルゴリズム設計
- スコアは0-100点の範囲で正規化
- 複数の要因を総合的に評価
- 診断データによる動的な調整

### パフォーマンス考慮
- データベースクエリの最適化
- 結果のキャッシュ可能な構造
- 必要最小限のデータ取得

### 拡張性
- 新しい評価基準の追加が容易
- スタイルタイプの追加に対応
- 機械学習への移行を考慮した設計

## セキュリティ考慮事項
- 診断結果へのアクセス権限確認
- 個人情報を含まない推奨結果
- 適切なエラーハンドリング

## 次のステップ
- 授業スタイルAPIの実装（タスク4.2）
- エンドポイントの定義とルーティング
- フロントエンドとの連携準備