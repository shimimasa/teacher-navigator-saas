# 2025-01-23 診断ウィザードコンポーネント実装

## 実施内容

### 1. 診断関連の型定義（types/diagnosis.ts）

#### 主要な型定義
- **DiagnosisQuestion**: 診断質問（ID、カテゴリー、質問文）
- **DiagnosisAnswer**: 回答データ（質問ID、値、タイムスタンプ）
- **DiagnosisSession**: 診断セッション（状態、回答、セッション情報）
- **DiagnosisResult**: 診断結果（パーソナリティタイプ、スコア、強み・課題）
- **DiagnosisProgress**: 進捗情報（現在の質問、カテゴリー別進捗）

#### カテゴリー定義
- **外向性・内向性**: 他者との関わり方
- **感覚・直感**: 情報処理の仕方
- **思考・感情**: 意思決定の基準
- **判断・知覚**: 外界への対処法

### 2. 診断APIサービス（services/diagnosis.ts）

#### 実装したメソッド
- `getQuestions()`: 診断質問の取得
- `startDiagnosis()`: 診断セッションの開始
- `saveAnswer()`: 回答の保存
- `submitDiagnosis()`: 診断の完了
- `getDiagnosisResult()`: 結果の取得
- `getDiagnosisHistory()`: 履歴の取得
- `submitFeedback()`: フィードバック送信
- `getDiagnosisStats()`: 統計情報取得

#### ユーティリティメソッド
- `calculateProgress()`: 進捗率の計算
- `validateAnswers()`: 回答の妥当性チェック

### 3. 診断ウィザードコンポーネント（DiagnosisWizard.tsx）

#### 主要機能
- 40問の質問を段階的に表示
- 回答の自動保存
- 進捗の可視化
- 中断・再開機能
- セッション管理

#### フロー
1. **開始画面**: 診断の説明と開始ボタン
2. **質問表示**: 1問ずつ表示、前後への移動可能
3. **回答保存**: リアルタイムで自動保存
4. **完了処理**: 最小回答数チェック後、結果画面へ遷移

#### 状態管理
- 質問リスト
- 現在の質問インデックス
- 回答データ（key-value形式）
- セッション情報
- エラー状態

### 4. 質問カードコンポーネント（QuestionCard.tsx）

#### デザイン
- カード形式のUI
- 質問番号とカテゴリー表示
- 5段階評価のラジオボタン
- 前後ナビゲーションボタン

#### 回答オプション
1. 全く当てはまらない
2. あまり当てはまらない
3. どちらとも言えない
4. やや当てはまる
5. 非常に当てはまる

#### インタラクション
- 選択時のハイライト
- ホバーエフェクト
- 回答必須チェック

### 5. 進捗表示コンポーネント（ProgressIndicator.tsx）

#### 表示内容
- **全体進捗**: リニアプログレスバー
- **回答数**: X/40問の形式
- **カテゴリー別進捗**: 円形プログレスバー
- **最小回答数達成**: 成功チップ表示

#### カスタム円形プログレスバー
- SVGを使用した実装
- アニメーション付き
- パーセンテージ表示

### 6. UX/UIの工夫

#### ユーザビリティ
- 自動保存で安心感を提供
- 進捗の可視化でモチベーション維持
- 中断・再開機能で柔軟性確保
- エラー時の適切なフィードバック

#### レスポンシブデザイン
- モバイル対応レイアウト
- タッチフレンドリーなボタンサイズ
- 適切な余白設定

#### パフォーマンス
- 質問の一括読み込み
- 回答の非同期保存
- 保存中インジケーター

## 技術的決定事項

### データ管理
- 回答はkey-value形式で管理（O(1)アクセス）
- セッション情報はサーバー側で管理
- クライアント側で進捗計算

### エラーハンドリング
- API通信エラーの適切な表示
- 保存失敗時の再試行機能（将来実装）
- ネットワーク切断時の対応（将来実装）

### セキュリティ
- 認証必須エンドポイント
- セッション単位でのアクセス制御
- XSS対策（React標準）

## 実装上の課題と解決

### 課題1: 回答の永続化
- **問題**: ページリロード時の回答消失
- **解決**: サーバー側セッション管理と自動保存

### 課題2: 進捗表示の精度
- **問題**: カテゴリー別質問数の不均等
- **解決**: 動的な進捗計算とサーバーからの情報取得

### 課題3: UXの最適化
- **問題**: 40問の長さによる離脱
- **解決**: 進捗表示、中断機能、保存通知

## 次のステップ
- 診断結果表示コンポーネント（タスク7.2）
- パーソナリティタイプの視覚的表示
- スコアのグラフ表示
- 強み・課題の詳細説明
- 推奨スタイルへの導線